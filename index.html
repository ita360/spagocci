<!DOCTYPE html>
<html lang="it">
<head>
<link rel="icon" href="https://raw.githubusercontent.com/spagocci/recensioni/blob/main/icona.png" type="image/png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spagocci 1.21 - Se Lo Vuoi con Forza Non √® un Sogno</title><style>
body {
  font-family: sans-serif;
  padding: 20px;
  background: #f9f9f9;
}
h1 { margin-bottom: 10px; }
button {
  margin-bottom: 10px;
  padding: 8px 12px;
  font-size: 1em;
  cursor: pointer;
}
#timer {
  font-size: 1.2em;
  font-weight: bold;
  color: #b30000;
  margin-left: 10px;
}

/* === LAYOUT GENERALE === */
.row {
  display: flex;
  gap: 0;
  height: 80vh;
}
.column {
  flex: 1;
  background: linear-gradient(to bottom,#fff,#f0f0f0);
  padding: 20px;
  border-radius: 20px;
  border: 4px solid #b30000;
  box-shadow:
    inset 0 0 10px rgba(0,0,0,0.1),
    0 4px 10px rgba(0,0,0,0.2);
  overflow-y: auto;
  margin-bottom: 10px;
  transition: transform .1s ease,box-shadow .2s ease;
  min-width: 100px;
}
.column:hover {
  box-shadow:
    inset 0 0 10px rgba(0,0,0,0.15),
    0 6px 14px rgba(0,0,0,0.3);
}
.column:active {
  transform: scale(0.98);
  box-shadow:
    inset 0 0 6px rgba(0,0,0,0.2),
    0 2px 6px rgba(0,0,0,0.2);
}

/* === STRUTTURA OGGETTI === */
.contenuto {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 15px;
  align-items: stretch;
}
.item {
  background:linear-gradient(to bottom,#fefefe,#eaeaea);
  border-radius:20px;
  border:4px solid #b30000;
  box-shadow:
    inset 0 0 10px rgba(0,0,0,0.1),
    0 4px 10px rgba(0,0,0,0.2);
  padding:12px;
  transition:transform .1s ease,box-shadow .2s ease;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.item:hover {
  box-shadow:
    inset 0 0 10px rgba(0,0,0,0.15),
    0 6px 14px rgba(0,0,0,0.3);
}
.item-content {
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  gap:10px;
}

/* === IMMAGINI E TESTO === */
img {
  max-width: 90%;
  height: auto;
  border-radius: 12px;
  object-fit: cover;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.price-big {
  font-size:1.3em;
  font-weight:bold;
  color:#009900;
  text-shadow:1px 1px 2px #0002;
  margin-top:5px;
}
.column a {
  color:#000;
  font-size:1em;
  font-weight:bold;
  text-decoration:none;
}
.column a:hover {
  text-decoration:underline;
}
small {
  color:#555;
  font-size:0.85em;
}

/* === RESIZER === */
.resizer {
  width:14px;
  background:#000;
  cursor:col-resize;
  user-select:none;
  touch-action:none;
  transition:background .2s ease;
}

/* === LINK BAR === */
.link-bar {
  font-size: 1em;
  margin-bottom: 15px;
  text-align: left;
  color: #000;
}
.link-bar a {
  color: #b30000;
  text-decoration: none;
  font-weight: bold;
}
.link-bar a:hover {
  text-decoration: underline;
}

/* === VERSIONE MOBILE === */
@media (max-width:900px){
  .row {
    flex-direction:column;
    height:auto;
  }
  .column {
    width:100%;
    margin-bottom:20px;
  }
  .resizer {
    display:none;
  }
  .contenuto {
    grid-template-columns: repeat(2, 1fr);
    gap:12px;
  }
  .item-content {
    gap:8px;
  }
  img {
    max-width: 100%;
    height:auto;
  }
  .price-big {
    font-size:1.2em;
  }
  h2 {
    text-align:center;
  }
  body {
    padding:10px;
  }
}
</style>
</head>

<body>
<p class="link-bar">
  <a href="https://discord.gg/zE25rQfg">ü§ñDiSCORD</a> -
  <a href="https://sites.google.com/view/davidespagocci/informazioni">üìòiSTRUZiONi</a> -
  <a href="https://whatsapp.com/channel/0029Vb6FyJ88qIzyi9nRtV2O">üì¶WHATSAPP Oggetti Disponibili Subito</a> -
  <a href="https://www.ebay.it/sch/i.html?_dkr=1&_ssn=davidespagocci">üõçÔ∏èEBAY</a>
</p>

<button id="toggleAudio">üîà Attiva Notifiche Audio</button>
<button id="toggleRefresh">‚è∏ Ferma aggiornamento</button>
<button id="btnValle">üò≠ ValleDiLacrime</button>
<span id="timer">Aggiornamento Pagina tra: 60 s</span>

<audio id="soundGenerale" src="https://raw.githubusercontent.com/spagocci/recensioni/main/tutti.mp3" preload="auto"></audio>
<audio id="soundPochiSecondi" src="https://raw.githubusercontent.com/spagocci/recensioni/main/perte.mp3" preload="auto"></audio>
<audio id="soundAttivate" src="https://raw.githubusercontent.com/spagocci/recensioni/main/attivate.mp3" preload="auto"></audio>
<audio id="soundDisattivate" src="https://raw.githubusercontent.com/spagocci/recensioni/main/disattivate.mp3" preload="auto"></audio>
<audio id="soundAggAttivato" src="https://raw.githubusercontent.com/spagocci/recensioni/main/aggattivato.mp3" preload="auto"></audio>
<audio id="soundAggDisattivato" src="https://raw.githubusercontent.com/spagocci/recensioni/main/aggdisattivato.mp3" preload="auto"></audio>
<audio id="soundValle" src="https://raw.githubusercontent.com/spagocci/recensioni/main/valledilacrime.mp3" preload="auto"></audio>

<div class="row">
  <div class="column" id="canaleSinistra">
    <h2>#tutti</h2>
    <div class="contenuto" id="contenutoSinistra"></div>
  </div>
  <div class="resizer" id="resizer1"></div>
  <div class="column" id="canaleDestra">
    <h2>#perpochisecondi</h2>
    <div class="contenuto" id="contenutoDestra"></div>
  </div>
  <div class="resizer" id="resizer2"></div>
  <div class="column" id="canaleFiltrati">
    <h2>#filtrati</h2>
    <div class="contenuto" id="contenutoFiltrati"></div>
  </div>
</div>

<script>
// === TIMER E REFRESH ===
let refreshInterval = 60;
let timeLeft = refreshInterval;
let refreshActive = true;
const timerDisplay = document.getElementById("timer");
const toggleButton = document.getElementById("toggleRefresh");

const soundAggAttivato = document.getElementById("soundAggAttivato");
const soundAggDisattivato = document.getElementById("soundAggDisattivato");

function updateTimerDisplay(){
  timerDisplay.textContent=`Aggiornamento Pagina tra: ${timeLeft}s`;
}
setInterval(()=>{
  if(!refreshActive)return;
  timeLeft--;
  if(timeLeft<=0){location.reload();}
  updateTimerDisplay();
},1000);

toggleButton.addEventListener("click", async ()=>{
  refreshActive=!refreshActive;
  toggleButton.textContent=refreshActive?"‚è∏ Ferma aggiornamento":"‚ñ∂Ô∏è Riprendi aggiornamento";

  try {
    if (refreshActive) {
      await soundAggAttivato.play();
    } else {
      await soundAggDisattivato.play();
    }
  } catch (e) {
    console.warn("‚ö†Ô∏è Errore audio aggiornamento:", e.message);
  }
});

// === AUDIO: ATTIVA/DISATTIVA CON MEMORIA + SUONO DI CONFERMA PERSONALIZZATO ===
let audioAttivo = localStorage.getItem('audioAttivo') === 'true';
let messaggiVisualizzati = new Set(JSON.parse(localStorage.getItem('messaggiVisualizzati') || '[]'));
let primaVolta = messaggiVisualizzati.size === 0;

const toggleAudioBtn = document.getElementById('toggleAudio');
const soundGenerale = document.getElementById('soundGenerale');
const soundPochiSecondi = document.getElementById('soundPochiSecondi');
const soundAttivate = document.getElementById('soundAttivate');
const soundDisattivate = document.getElementById('soundDisattivate');
const soundValle = document.getElementById('soundValle');
const btnValle = document.getElementById('btnValle');

function aggiornaBottoneAudio() {
  toggleAudioBtn.textContent = audioAttivo
    ? "üîá Disattiva Notifiche Audio"
    : "üîà Attiva Notifiche Audio";
}
aggiornaBottoneAudio();

toggleAudioBtn.addEventListener('click', async () => {
  audioAttivo = !audioAttivo;
  localStorage.setItem('audioAttivo', audioAttivo);
  aggiornaBottoneAudio();

  try {
    await soundGenerale.play();
    soundGenerale.pause(); soundGenerale.currentTime = 0;
    await soundPochiSecondi.play();
    soundPochiSecondi.pause(); soundPochiSecondi.currentTime = 0;

    if (audioAttivo) {
      await soundAttivate.play();
    } else {
      await soundDisattivate.play();
    }
  } catch (e) {
    console.warn('‚ö†Ô∏è Errore durante riproduzione suono di conferma:', e.message);
  }
});

// === BOTTONE VALLEDILACRIME ===
btnValle.addEventListener('click', async ()=>{
  try {
    await soundValle.play();
  } catch (e) {
    console.warn('‚ö†Ô∏è Errore riproduzione ValleDiLacrime:', e.message);
  }
});

// === CARICAMENTO DATI OGNI 10s ===
function caricaCatalogo(){
  const timestamp=new Date().getTime();
  fetch(`https://spagocci.github.io/recensioni/data.json?t=${timestamp}`)
  .then(res=>res.json())
  .then(data=>{
    data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
    const sinistra=document.getElementById('contenutoSinistra');
    const destra=document.getElementById('contenutoDestra');
    const filtrati=document.getElementById('contenutoFiltrati');
    sinistra.innerHTML=destra.innerHTML=filtrati.innerHTML='';

    data.forEach(item=>{
      const isNuovo=!messaggiVisualizzati.has(item.id);
      messaggiVisualizzati.add(item.id);
      localStorage.setItem('messaggiVisualizzati',JSON.stringify([...messaggiVisualizzati]));

      const div=document.createElement('div');
      div.className='item';
      div.innerHTML=`
        <div class="item-content">
          ${item.image?`<img src="${item.image}" alt="Immagine">`:''}
          ${item.price?`<div class="price-big">${item.price}</div>`:''}
          <div>
            ${item.link?`<p><a href="${item.link}" target="_blank">${item.text}</a></p>`:`<p>${item.text}</p>`}
            <small>${new Date(item.timestamp).toLocaleString()}</small>
          </div>
        </div>`;

      if(item.sourceChannel==='1432128848534962402'){
        sinistra.appendChild(div);
        if(!primaVolta&&audioAttivo&&isNuovo)soundGenerale.play().catch(()=>{});
      }else if(item.sourceChannel==='1430829927175032954'){
        destra.appendChild(div);
        if(!primaVolta&&audioAttivo&&isNuovo)soundPochiSecondi.play().catch(()=>{});
      }else if(item.sourceChannel==='1431551820509089842'){
        filtrati.appendChild(div);
        if(!primaVolta&&audioAttivo&&isNuovo)soundGenerale.play().catch(()=>{});
      }
    });
  })
  .catch(err=>{
    ['contenutoSinistra','contenutoDestra','contenutoFiltrati'].forEach(id=>{
      document.getElementById(id).innerHTML=`<p style="color:red;">‚ùå Errore: ${err.message}</p>`;
    });
  });
}
caricaCatalogo();
setInterval(caricaCatalogo,10000);

// === RIDIMENSIONAMENTO COLONNE ===
function aggiungiResizer(resizer,colSX,colDX){
  let x=0,colSXWidth=0;
  const down=e=>{
    x=e.clientX;
    colSXWidth=colSX.getBoundingClientRect().width;
    document.addEventListener('mousemove',move);
    document.addEventListener('mouseup',up);
    resizer.style.background='#b30000';
  };
  const move=e=>{
    const dx=e.clientX-x;
    colSX.style.flex=`0 0 ${colSXWidth+dx}px`;
  };
  const up=()=>{
    document.removeEventListener('mousemove',move);
    document.removeEventListener('mouseup',up);
    resizer.style.background='#000';
  };
  resizer.addEventListener('mousedown',down);
}
aggiungiResizer(document.getElementById('resizer1'),
                document.getElementById('canaleSinistra'),
                document.getElementById('canaleDestra'));
aggiungiResizer(document.getElementById('resizer2'),
                document.getElementById('canaleDestra'),
                document.getElementById('canaleFiltrati'));
</script>
</body>
</html>



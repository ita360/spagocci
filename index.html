<!DOCTYPE html>
<html lang="it">
<head>
<link rel="icon" href="https://github.com/spagocci/recensioni/blob/main/icona.png" type="image/png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spagocci 1.1.0</title>
<style>
body {
  font-family:sans-serif;
  padding:20px;
  background:#f9f9f9;
}
button {
  margin-bottom:10px;
  padding:8px 12px;
  font-size:1em;
  cursor:pointer;
}

/* === INPUT NASCONDI & CERCA === */
#filtroParole {
  width:100%;
  max-width:400px;
  padding:8px 10px;
  margin:10px 0;
  font-size:1em;
  border:2px solid #b30000;
  border-radius:10px;
  box-sizing:border-box;
}

/* 🔍 CASSELLA "CERCA" con X */
#mostraBox {
  position:relative;
  width:100%;
  max-width:400px;
  margin:10px 0;
}
#mostraParole {
  width:100%;
  padding:8px 10px;
  font-size:1em;
  border:2px solid #b30000;
  border-radius:10px;
  box-sizing:border-box;
}
#clearMostra {
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  background:#b30000;
  color:white;
  border:none;
  border-radius:50%;
  width:22px;
  height:22px;
  cursor:pointer;
  font-weight:bold;
  display:none;
  line-height:18px;
  z-index:1;
}
#clearMostra:hover{background:darkred;}

#statusBar {
  display:flex;
  align-items:center;
  gap:15px;
  margin-bottom:15px;
}
#conteggioNascosti {
  font-weight:bold;
  color:#b30000;
}
#timer {
  font-weight:bold;
  color:#009900;
}

/* === LAYOUT === */
.row {
  display: flex;
  flex-wrap: wrap; /* ✅ permette di andare a capo */
  gap: 10px;
  height: auto;
}

.column {
  flex: 1 1 300px; /* ✅ minimo 300px di larghezza */
  background: linear-gradient(to bottom,#fff,#f0f0f0);
  padding: 20px;
  border-radius: 20px;
  border: none;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.05), 0 4px 10px rgba(0,0,0,0.1);
  overflow-y: auto;
}

/* === POSIZIONE SPECIALE VETRINA === */
.vetrina-top {
  width: 100%;
  margin-bottom: 25px; /* spazio tra vetrina e le colonne sotto */
  background: linear-gradient(to bottom, #fff, #f5f5f5);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}


/* === OGGETTI SENZA CARD O BORDI === */
.contenuto {
  grid-template-columns: repeat(2, minmax(0, 1fr)); /* ✅ impedisce overflow */
  gap: 6px; /* ✅ riduce leggermente lo spazio tra le card */
  padding: 0 4px; /* ✅ margine interno laterale minore */
  box-sizing: border-box; /* ✅ calcolo preciso larghezza */
}
.item-content img {
  max-width: 120px; /* ✅ leggermente più strette per far stare 2 intere */
}


.item {
  background: none;
  border: none;
  box-shadow: none;
  padding: 5px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.item-content {
  text-align: center;
}

.item-content img {
  width: 100%;
  max-width: 200px;
  aspect-ratio: 1/1;
  object-fit: contain;
  border-radius: 0;
}

.price-big {
  font-weight: bold;
  color: #009900;
  font-size: 1em;
}

.column a {
  color: #000;
  text-decoration: none;
  font-weight: bold;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-height: 1.2em;
}
.column a:hover { text-decoration: underline; }

small { color: #666; font-size: 0.8em; }

/* === VETRINA SCORREVOLE === */
#contenutoVetrina {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 10px;
  scroll-behavior: smooth;
  padding-bottom: 10px;
}

#contenutoVetrina .item {
  flex: 0 0 auto;
  text-align: center;
  width: 160px; /* ✅ dimensione card più compatta */
}

/* === RESPONSIVE MOBILE === */
@media(max-width:768px){
  /* Layout generale */
  .row {
    flex-direction: column; /* ✅ una colonna per riga */
  }
  .column {
    flex: 1 1 100%;
    max-width: 100%;
    padding: 10px;
  }

  /* Oggetti nella griglia */
  .contenuto {
    grid-template-columns: repeat(2, 1fr); /* ✅ 2 oggetti per riga */
    gap: 8px;
  }
  .item-content img {
    max-width: 130px;   /* immagini più compatte */
  }

  /* Testo e dettagli */
  .column a {
    -webkit-line-clamp: 2;
    font-size: 0.8em;
    line-height: 1.1em;
  }
  .price-big { font-size: 0.9em; }
  small { font-size: 0.7em; }
  h2 { font-size: 0.9em; margin-bottom: 5px; }
}



/* === MODALE === */
#modaleParole{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.5);display:none;
  justify-content:center;align-items:center;z-index:1000;
}
#modaleContenuto{
  background:#fff;padding:20px;border-radius:15px;
  width:90%;max-width:500px;box-shadow:0 0 15px rgba(0,0,0,0.3);
}
#modaleContenuto textarea{
  width:100%;height:120px;font-size:1em;padding:8px;
  border-radius:8px;border:2px solid #b30000;resize:none;
}
#modaleContenuto button{margin-top:10px;margin-right:10px;}
</style>
</head>
<body>
<p class="link-bar">
  <b><a href="https://discord.gg/zE25rQfg">🤖DiSCORD</a> -
  <a href="https://sites.google.com/view/davidespagocci/informazioni">📘iSTRUZiONi</a> -
  <br><a href="https://www.ebay.it/sch/i.html?_dkr=1&_ssn=davidespagocci">🛍️EBAY</a></b>
</p>
<div id="mostraBox">
  <input id="mostraParole" type="text" placeholder="Cerca Parole (es: Cane, Per Lamborghini)🔍">
  <button id="clearMostra">❌</button>
</div>
<input id="filtroParole" type="text" placeholder="Nascondi Parole (es: Custodia, per finestre)🚫">
<button id="btnGestisciParole">✏️Nascoste🫣</button>
<button id="toggleAudio">📢Notifiche</button>
<button id="btnSoloMigliori">i <b>Migli⭐ri</b></button>
<button id="btnAdulti">🚫No Sesso</button>

<div id="statusBar">
  <span id="conteggioNascosti">🔕 Oggetti nascosti: 0</span>
  <span id="timer">60 s</span>
</div>
<!-- === MODALE === -->
<div id="modaleParole">
  <div id="modaleContenuto">
    <h3>✏️ Parole Nascoste</h3>
    <p>Inserisci parole o frasi separate da virgole o punti e virgola:</p>
    <textarea id="modaleTextarea"></textarea><br>
    <button id="salvaParole">💾 Salva</button>
    <button id="cancellaParole">🗑️ Cancella Tutto</button>
    <button id="chiudiModale">❌ Chiudi</button>
  </div>
</div>

<!-- === AUDIO === -->
<audio id="audioGenerale" src="https://raw.githubusercontent.com/spagocci/recensioni/main/tutti.mp3" preload="auto"></audio>
<audio id="audioPochiSecondi" src="https://raw.githubusercontent.com/spagocci/recensioni/main/perte.mp3" preload="auto"></audio>
<audio id="audioAttivate" src="https://raw.githubusercontent.com/spagocci/recensioni/main/attivate.mp3" preload="auto"></audio>
<audio id="audioDisattivate" src="https://raw.githubusercontent.com/spagocci/recensioni/main/disattivate.mp3" preload="auto"></audio>
<audio id="audioAggAttivato" src="https://raw.githubusercontent.com/spagocci/recensioni/main/aggattivato.mp3" preload="auto"></audio>
<audio id="audioAggDisattivato" src="https://raw.githubusercontent.com/spagocci/recensioni/main/aggdisattivato.mp3" preload="auto"></audio>
<audio id="audioValle" src="https://raw.githubusercontent.com/spagocci/recensioni/main/valledilacrime.mp3" preload="auto"></audio>


<!-- === VETRINA IN ALTO === -->
<div class="column vetrina-top" id="canaleVetrina">
  <h2>#Vetrina Disponibili da Subito o in Arrivo</h2>
  <div class="contenuto" id="contenutoVetrina"></div>
</div>

<!-- === COLONNE === -->
<div class="row">
  <div class="column" id="canaleSinistra">
    <h2>🤢Tutti🤮 Offerte per pochi secondi (qui PURTROPPO vedrai tutto anche custodie,pellicole e tantissimi altri oggetti inutili che non vorresti vedere se però premi il bottone <b></b>⭐i migliori<b> in alto a questa pagina potrai vedere una lista con meno cose inutili che applica dei miei filtri</b>)</h2>
    <div class="contenuto" id="contenutoSinistra"></div>
  </div>
  <div class="column" id="canaleFiltrati">
    <h2>⭐i migliori🛡️🙅‍♂️ Offerte per pochi secondi</h2>
    <div class="contenuto" id="contenutoFiltrati"></div>
  </div>
  <div class="column" id="canaleAdulti">
    <h2>🍑👙adulti💋🍓</h2>
    <div class="contenuto" id="contenutoAdulti"></div>
  </div>
  <div class="column" id="canaleDestra">
    <h2>👮‍♂️Sicurezza🚓🚨 (ignorate questa colonna serve a me per capire delle cose)</h2>
    <div class="contenuto" id="contenutoDestra"></div>
  </div>
</div>
<div style="
  background:#fff8e1;
  border-left:5px solid #b30000;
  padding:15px;
  border-radius:10px;
  font-family:sans-serif;
  font-size:1em;
  line-height:1.5em;
  color:#333;
  margin:15px 0;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
">
    <b>ℹ️ Attenzione!</b><br>
  Vedi la pagina VUOTA senza oggetti? è normale! questa pagina si riempie <b>solo durante le ondate di nuovi oggetti in offerta</b>, che durano pochi secondi.<br><br>
  🔔 Iscriviti al mio 
  <a href="https://whatsapp.com/channel/0029Vb6FyJ88qIzyi9nRtV2O" target="_blank" style="color:#0a84ff;font-weight:bold;text-decoration:none;">
    📦 canale WhatsApp
  </a> 
  per ricevere un avviso ogni volta che arriva una nuova ondata.<br><br>
  <b>Oppure</b> lascia questa pagina aperta e 
  <b>attiva le notifiche</b> premendo il pulsante corrispondente: 
  <span style="color:green;font-weight:bold;">sentirai un suono</span> 
  quando saranno disponibili nuovi articoli con offerte che durano pochi secondi<br>
  Contattami il più veloce che puoi su whattap quando ne vuoi uno perchè purtroppo li fregano gli altri recensori in pochi secondi se non li prendiamo noi.
</div>

<button id="toggleRefresh">⏸ Ferma aggiornamento</button>
<button id="btnValle">😭 Valle Di Lacrime</button>

<script>
/* === TIMER === */
let refreshInterval=60,timeLeft=refreshInterval,refreshActive=true;
const timerDisplay=document.getElementById("timer");
function updateTimerDisplay(){timerDisplay.textContent = timeLeft;}
setInterval(()=>{if(!refreshActive)return;timeLeft--;if(timeLeft<=0)location.reload();updateTimerDisplay();},1000);

/* === AUDIO E BOTTONI REFRESH === */
const toggleButton=document.getElementById("toggleRefresh");
const audioAggAttivato=document.getElementById("audioAggAttivato");
const audioAggDisattivato=document.getElementById("audioAggDisattivato");
toggleButton.addEventListener("click",async()=>{
  refreshActive=!refreshActive;
  toggleButton.textContent=refreshActive?"⏸ Ferma aggiornamento":"▶️ Riprendi aggiornamento";
  try{if(refreshActive)await audioAggAttivato.play();else await audioAggDisattivato.play();}
  catch(e){console.warn("Errore audio:",e.message);}
});

/* === AUDIO NOTIFICHE === */
let audioAttivo=localStorage.getItem('audioAttivo')==='true';
let messaggiVisualizzati=new Set(JSON.parse(localStorage.getItem('messaggiVisualizzati')||'[]'));
let primaVolta=messaggiVisualizzati.size===0;
const toggleAudioBtn=document.getElementById('toggleAudio');
const audioGenerale=document.getElementById('audioGenerale');
const audioPochiSecondi=document.getElementById('audioPochiSecondi');
const audioAttivate=document.getElementById('audioAttivate');
const audioDisattivate=document.getElementById('audioDisattivate');
const audioValle=document.getElementById('audioValle');
const btnValle=document.getElementById('btnValle');
function aggiornaBottoneAudio(){toggleAudioBtn.textContent=audioAttivo?"🔊Audio":"🔇Audio";}
aggiornaBottoneAudio();
btnValle.addEventListener('click',async()=>{try{await audioValle.play();}catch(e){console.warn("Errore audio:",e.message);}});
toggleAudioBtn.addEventListener('click',async()=>{
  audioAttivo=!audioAttivo;
  localStorage.setItem('audioAttivo',audioAttivo);
  aggiornaBottoneAudio();
  try{
    await audioGenerale.play();audioGenerale.pause();audioGenerale.currentTime=0;
    await audioPochiSecondi.play();audioPochiSecondi.pause();audioPochiSecondi.currentTime=0;
    if(audioAttivo)await audioAttivate.play();else await audioDisattivate.play();
  }catch(e){console.warn("Errore audio:",e.message);}
});

/* === CARICAMENTO OGGETTI === */
function caricaCatalogo() {
  const t = Date.now();
  fetch(`https://spagocci.github.io/recensioni/data.json?t=${t}`)
    .then(r => r.json())
    .then(data => {
      data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      const s = document.getElementById('contenutoSinistra');
      const d = document.getElementById('contenutoDestra');
      const f = document.getElementById('contenutoFiltrati');
      const a = document.getElementById('contenutoAdulti');
      const vetrina = document.getElementById('contenutoVetrina');

      // pulizia iniziale
      s.innerHTML = d.innerHTML = f.innerHTML = a.innerHTML = vetrina.innerHTML = '';

      data.forEach(item => {
        const isNuovo = !messaggiVisualizzati.has(item.id);
        messaggiVisualizzati.add(item.id);
        localStorage.setItem('messaggiVisualizzati', JSON.stringify([...messaggiVisualizzati]));
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="item-content">
            ${item.image && item.link ? `<img src="${item.image}" alt="" class="clickable-img" data-link="${item.link}">` : item.image ? `<img src="${item.image}" alt="">` : ''}
            ${item.price ? `<div class="price-big">${item.price}</div>` : ''}
            <p>${item.link ? `<a href="${item.link}" target="_blank">${item.text}</a>` : item.text}</p>
            <small>${new Date(item.timestamp).toLocaleString()}</small>
          </div>`;

        if (item.sourceChannel === '1432128848534962402') { // #tutti
          s.appendChild(div); if (!primaVolta && audioAttivo && isNuovo) audioGenerale.play().catch(() => {});
        } else if (item.sourceChannel === '1430829927175032954') { // #perpochisecondi
          d.appendChild(div); if (!primaVolta && audioAttivo && isNuovo) audioPochiSecondi.play().catch(() => {});
        } else if (item.sourceChannel === '1431551820509089842') { // #filtrati
          f.appendChild(div); if (!primaVolta && audioAttivo && isNuovo) audioGenerale.play().catch(() => {});
        } else if (item.sourceChannel === '1433144661186318630') { // #adulti
          a.appendChild(div); if (!primaVolta && audioAttivo && isNuovo) audioGenerale.play().catch(() => {});
        } else if (item.sourceChannel === '1433444235851468980') { // #vetrina
          vetrina.appendChild(div);
          if (!primaVolta && audioAttivo && isNuovo) audioGenerale.play().catch(() => {});
        }
      });

      applicaFiltri();
      primaVolta = false; // ✅ solo dopo il primo caricamento
    })
    .catch(err => {
      ['contenutoSinistra', 'contenutoDestra', 'contenutoFiltrati', 'contenutoAdulti', 'contenutoVetrina'].forEach(id => {
        document.getElementById(id).innerHTML = `<p style="color:red;">❌ ${err.message}</p>`;
      });
    });
}

// ✅ Queste due righe devono stare FUORI dalla funzione:
caricaCatalogo();
setInterval(caricaCatalogo, 10000);

/* === FILTRI (nascondi + cerca) === */
const filtroInput = document.getElementById('filtroParole');
const mostraInput = document.getElementById('mostraParole');
const clearMostra = document.getElementById('clearMostra');
const conteggioNascosti = document.getElementById('conteggioNascosti');

filtroInput.value = localStorage.getItem('paroleNascondi') || '';
mostraInput.value = localStorage.getItem('mostraParole') || '';

if (mostraInput.value.trim()) clearMostra.style.display = 'inline-block';

filtroInput.addEventListener('input', ()=>{
  localStorage.setItem('paroleNascondi', filtroInput.value.trim());
  applicaFiltri();
});
mostraInput.addEventListener('input', ()=>{
  localStorage.setItem('mostraParole', mostraInput.value.trim());
  clearMostra.style.display = mostraInput.value.trim() ? 'inline-block' : 'none';
  applicaFiltri();
});
clearMostra.addEventListener('click', ()=>{
  mostraInput.value = '';
  localStorage.removeItem('mostraParole');
  clearMostra.style.display = 'none';
  applicaFiltri();
});

function applicaFiltri(){
  const nascondi = filtroInput.value.toLowerCase().split(/[;,]+/).map(x=>x.trim()).filter(Boolean);
  const mostra = mostraInput.value.toLowerCase().split(/[;,]+/).map(x=>x.trim()).filter(Boolean);
  let nascosti = 0;
  document.querySelectorAll('.item').forEach(el=>{
    const testo = (el.innerText || '').toLowerCase();
    const hide = nascondi.some(w=>testo.includes(w));
    const show = mostra.length===0 || mostra.some(w=>testo.includes(w));
    const vis = !hide && show;
    el.style.display = vis ? '' : 'none';
    if(!vis) nascosti++;
  });
  conteggioNascosti.textContent = `🔕 Oggetti nascosti: ${nascosti}`;
}
</script>
  <script>
/* =========================================================
 * 🔄 AGGIORNAMENTO AUTOMATICO BACHECA PUBBLICA (GitHub)
 * =======================================================*/
const BACHECA_URL = "https://spagocci.github.io/recensioni/bacheca.json";
const chatLista = document.getElementById('chatLista');

async function caricaBacheca() {
  try {
    const res = await fetch(`${BACHECA_URL}?t=${Date.now()}`);
    if (!res.ok) throw new Error("Errore nel caricamento");
    const data = await res.json();

    chatLista.innerHTML = ""; // pulizia
    data.forEach(m => {
      const div = document.createElement("div");
      div.style = "background:white;padding:8px;margin-bottom:6px;border-radius:5px;border:1px solid #ddd;position:relative;";
      div.innerHTML = `
        <b>${m.autore}</b>
        <small style="color:gray;">(${m.userId})</small>: ${m.testo}
        <div style="position:absolute;right:5px;top:5px;">
          ${
            m.userId === mioID
              ? `<button onclick="modificaMessaggio('${m.id}')" style="background:#ffcc00;border:none;border-radius:3px;padding:2px 6px;cursor:pointer;">✏️</button>
                 <button onclick="cancellaMessaggio('${m.id}')" style="background:#ff4444;color:white;border:none;border-radius:3px;padding:2px 6px;cursor:pointer;">🗑️</button>`
              : `<button onclick="nascondiMessaggio('${m.id}')" style="background:#ccc;border:none;border-radius:3px;padding:2px 6px;cursor:pointer;">🙈</button>
                 <button onclick="bannaUtente('${m.userId}','${m.autore.replace(/'/g,"\\'")}')" style="background:#990000;color:white;border:none;border-radius:3px;padding:2px 6px;cursor:pointer;">🚫</button>`
          }
        </div>
      `;
      chatLista.appendChild(div);
    });
  } catch (e) {
    chatLista.innerHTML = `<p style="color:red;">❌ Errore nel caricamento della bacheca: ${e.message}</p>`;
  }
}

// Aggiornamento automatico ogni 10 secondi
setInterval(caricaBacheca, 10_000);
caricaBacheca();
</script>

</body>
  
</html>
 







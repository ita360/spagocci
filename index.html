<!DOCTYPE html>
<html lang="it">
<head>
<link rel="icon" href="https://github.com/spagocci/recensioni/blob/main/icona.png" type="image/png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spagocci 1.29 - Ricerca visiva migliorata</title>
<style>
body {
  font-family: sans-serif;
  padding: 20px;
  background: #f9f9f9;
}
button {
  margin-bottom: 10px;
  padding: 8px 12px;
  font-size: 1em;
  cursor: pointer;
}
#filtroParole, #mostraParole {
  width: 100%;
  max-width: 400px;
  padding: 8px 10px;
  margin: 10px 0 10px 0;
  font-size: 1em;
  border: 2px solid #b30000;
  border-radius: 10px;
}

/* 🔍 CASSELLA "CERCA" con X */
#mostraBox {
  position: relative;
  display: inline-block;
}
#clearMostra {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: #b30000;
  color: white;
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  cursor: pointer;
  font-weight: bold;
  display: none;
}
#clearMostra:hover { background: darkred; }

#statusBar {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}
#conteggioNascosti {
  display: inline-block;
  font-size: 1em;
  font-weight: bold;
  color: #b30000;
}
#timer {
  font-size: 1em;
  font-weight: bold;
  color: #009900;
}
.row {
  display: flex;
  gap: 10px;
  height: 80vh;
}
.column {
  flex: 1;
  background: linear-gradient(to bottom,#fff,#f0f0f0);
  padding: 20px;
  border-radius: 20px;
  border: 4px solid #b30000;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.1), 0 4px 10px rgba(0,0,0,0.2);
  overflow-y: auto;
}
.contenuto {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 15px;
}
.item {
  background:linear-gradient(to bottom,#fefefe,#eaeaea);
  border-radius:20px;
  border:4px solid #b30000;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.1), 0 4px 10px rgba(0,0,0,0.2);
  padding:12px;
  display:flex;
  flex-direction:column;
  transition: opacity 0.2s ease;
}
.item-content {
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  gap:10px;
}
img { max-width:90%; border-radius:12px; }
.price-big { font-size:1em; font-weight:bold; color:#009900; }
.column a { color:#000; text-decoration:none; font-weight:bold; }
.column a:hover { text-decoration:underline; }
@media (max-width:900px){ .row { flex-direction:column; height:auto; } }
</style>
</head>

<body>
<p class="link-bar">
  <b><a href="https://discord.gg/zE25rQfg">🤖DiSCORD</a> -
  <a href="https://sites.google.com/view/davidespagocci/informazioni">📘iSTRUZiONi</a> -
  <a href="https://whatsapp.com/channel/0029Vb6FyJ88qIzyi9nRtV2O">📦WHATSAPP</a> -
  <a href="https://www.ebay.it/sch/i.html?_dkr=1&_ssn=davidespagocci">🛍️EBAY</a></b>
</p>

<!-- CASELLA NASCONDI -->
<input id="filtroParole" type="text" placeholder="Nascondi oggetti con parola (es: custodia, cover)">
<button id="btnGestisciParole">✏️ Gestisci Parole Nascoste</button>
<button id="toggleAudio">🔈 Attiva Notifiche Audio</button>
<button id="btnSoloMigliori">⭐Solo i <b>Migliori oggetti</b></button>
<button id="btnAdulti">🔞Nascondi Sesso</button> 
<!-- 🔍 NUOVA CASELLA "CERCA" -->
<div id="mostraBox">
  <input id="mostraParole" type="text" placeholder="Cerca Oggetto con parola (es: Cane, Cucina, Per Lamborghini)">
  <button id="clearMostra">❌</button>
</div>
<div id="statusBar">
  <span id="conteggioNascosti">🔕 Oggetti nascosti: 0</span>
  <span id="timer">Agg. tra: 60 s</span>
</div>

<div class="row">
  <div class="column" id="canaleSinistra">
    <h2>#tutti</h2>
    <div class="contenuto" id="contenutoSinistra"></div>
  </div>
  <div class="column" id="canaleFiltrati">
    <h2>#filtrati</h2>
    <div class="contenuto" id="contenutoFiltrati"></div>
  </div>
</div>

<script>
// ==================== TIMER RICARICA ====================
let refreshInterval = 60;
let timeLeft = refreshInterval;
let refreshActive = true;
const timerDisplay = document.getElementById("timer");
function updateTimerDisplay(){ timerDisplay.textContent=`Agg. tra: ${timeLeft}s`; }
setInterval(()=>{ if(!refreshActive)return; timeLeft--; if(timeLeft<=0)location.reload(); updateTimerDisplay(); },1000);

// ==================== CARICAMENTO OGGETTI ====================
function caricaCatalogo(){
  const timestamp=new Date().getTime();
  fetch(`https://spagocci.github.io/recensioni/data.json?t=${timestamp}`)
  .then(res=>res.json())
  .then(data=>{
    data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
    const sinistra=document.getElementById('contenutoSinistra');
    const filtrati=document.getElementById('contenutoFiltrati');
    sinistra.innerHTML=filtrati.innerHTML='';

    data.forEach(item=>{
      const div=document.createElement('div');
      div.className='item';
      div.innerHTML=`<div class="item-content">
        ${item.image?`<img src="${item.image}" alt="Immagine">`:''}
        ${item.price?`<div class="price-big">${item.price}</div>`:''}
        <div>${item.link?`<p><a href="${item.link}" target="_blank">${item.text}</a></p>`:`<p>${item.text}</p>`}
        <small>${new Date(item.timestamp).toLocaleString()}</small></div>
      </div>`;
      if(item.sourceChannel==='1431551820509089842') filtrati.appendChild(div);
      else sinistra.appendChild(div);
    });
    applicaFiltriCombinati();
  })
  .catch(err=>console.error("Errore:",err));
}
caricaCatalogo();
setInterval(caricaCatalogo,10000);

// ==================== FILTRI COMBINATI ====================
const filtroInput = document.getElementById('filtroParole');
const mostraInput = document.getElementById('mostraParole');
const clearMostra = document.getElementById('clearMostra');
const conteggioNascosti = document.getElementById('conteggioNascosti');

// ✅ Mantiene parola "Cerca" anche dopo refresh
mostraInput.value = localStorage.getItem('mostraParole') || '';
filtroInput.value = localStorage.getItem('paroleNascondi') || '';

if (mostraInput.value.trim()) clearMostra.style.display = 'inline-block';

mostraInput.addEventListener('input', ()=>{
  localStorage.setItem('mostraParole', mostraInput.value.trim());
  clearMostra.style.display = mostraInput.value.trim() ? 'inline-block' : 'none';
  applicaFiltriCombinati();
});
clearMostra.addEventListener('click', ()=>{
  mostraInput.value = '';
  localStorage.removeItem('mostraParole');
  clearMostra.style.display = 'none';
  applicaFiltriCombinati();
});
filtroInput.addEventListener('input', ()=>{
  localStorage.setItem('paroleNascondi', filtroInput.value.trim());
  applicaFiltriCombinati();
});

function applicaFiltriCombinati() {
  const nascondiFrasi = filtroInput.value.trim().toLowerCase().split(/[;,]+/).map(p=>p.trim()).filter(Boolean);
  const mostraFrasi = mostraInput.value.trim().toLowerCase().split(/[;,]+/).map(p=>p.trim()).filter(Boolean);
  let nascosti = 0;
  document.querySelectorAll('.item').forEach(el=>{
    const testo=((el.querySelector('p')?.innerText||'')+' '+(el.querySelector('.price-big')?.innerText||'')).toLowerCase();
    const contieneNascondi = nascondiFrasi.some(f=>testo.includes(f));
    const contieneMostra = mostraFrasi.length===0 || mostraFrasi.some(f=>testo.includes(f));
    const visibile = !contieneNascondi && contieneMostra;
    el.style.display = visibile ? '' : 'none';
    if (!visibile) nascosti++;
  });
  conteggioNascosti.textContent = `🔕 Oggetti nascosti: ${nascosti}`;
}
</script>
</body>
</html>
